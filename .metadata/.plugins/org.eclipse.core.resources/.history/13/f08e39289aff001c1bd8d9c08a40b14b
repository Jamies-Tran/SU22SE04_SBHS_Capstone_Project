package com.swm.controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;

import com.swm.converter.MomoOrderProcessConverter;
import com.swm.dto.MomoOrderProcessDto;
import com.swm.dto.WalletDto;
import com.swm.entity.MomoOrderProcessEntity;
import com.swm.entity.WalletEntity;
import com.swm.service.IWalletService;

@Controller
public class TestController {
	@Autowired
	private IWalletService walletService;
	
	@GetMapping("/redirect/url")
	public ResponseEntity<?> captureRedirectUrl(@RequestParam String partnerCode, @RequestParam String orderId,
			@RequestParam String requestId, @RequestParam Long amount, @RequestParam String orderInfo,
			@RequestParam String orderType, @RequestParam String transId, @RequestParam String resultCode,
			@RequestParam String message, @RequestParam String payType, @RequestParam String extraData,
			@RequestParam String signature) {
		
		MomoOrderProcessDto momoOrderProcessDto = new MomoOrderProcessDto(
				partnerCode, orderId, requestId, amount, orderInfo, orderType, transId, resultCode, message, payType, extraData, signature);
		MomoOrderProcessEntity  momoOrderProcessEntity = MomoOrderProcessConverter.momoOrderProcessToEntity(momoOrderProcessDto);
		WalletEntity momoOrderProcessPersisted = walletService.addWalletBalance(momoOrderProcessEntity);
		WalletDto walletResponseDto = walletConvert.walletToDto(momoOrderProcessPersisted);

		return new ResponseEntity<>(walletResponseDto , HttpStatus.OK);
	}
}
